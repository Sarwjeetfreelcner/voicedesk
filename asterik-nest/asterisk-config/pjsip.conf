; ==========================
; pjsip.conf — updated version
; ==========================

[global]
type = global
endpoint_identifier_order = ip,username
allow_unauthenticated_options = yes

; ================
; Transport section
; ================
[transport-udp]
type = transport
protocol = udp
bind = 0.0.0.0:5060
; (optional) if NAT / external, you may keep external_… here
external_signaling_address = 195.34.79.69
external_media_address = 195.34.79.69

; =======================
; SIP TRUNK — TrustedTelecoms
; =======================
[trustedtelecoms]
type = endpoint
context = from-trunk
disallow = all
allow = ulaw
allow = alaw
allow = g722
aors = trustedtelecoms_aor
outbound_auth = trustedtelecoms_auth
force_rport = yes
rewrite_contact = yes
; Add From header details expected by provider
from_domain = sip20.trustedtelecoms.net
from_user = 8867730344P0AUi0

[trustedtelecoms_auth]
type = auth
auth_type = userpass
username = 8867730344P0AUi0
password = 982iLZiGfQxU

[trustedtelecoms_aor]
type = aor
max_contacts = 1
contact = sip:8867730344P0AUi0@195.34.79.33:5060
default_expiration = 3600

[trustedtelecoms_reg]
type = registration
transport = transport-udp
outbound_auth = trustedtelecoms_auth
server_uri = sip:195.34.79.33:5060
client_uri = sip:8867730344P0AUi0@sip20.trustedtelecoms.net:5060
retry_interval = 60
forbidden_retry_interval = 600
expiration = 300
; Ensure Contact user matches account (often required by providers)
contact_user = 8867730344P0AUi0
; Use provider proxy to ensure routing to provider host
outbound_proxy = sip:195.34.79.33:5060;lr

[trustedtelecoms-identify]
type = identify
endpoint = trustedtelecoms
match = 195.34.79.33

; ============================
; LINPHONE EXTENSION — 6001
; ============================
[6001]
type = endpoint
context = from-internal
transport = transport-udp
disallow = all
allow = ulaw
allow = alaw
allow = g722
auth = auth6001
aors = aor6001
force_rport = yes
rewrite_contact = yes

[auth6001]
type = auth
auth_type = userpass
username = 6001
password = StrongPass123

[aor6001]
type = aor
max_contacts = 1
default_expiration = 3600

[6001-identify]
type = identify
endpoint = 6001
; match the network or IP(s) from which Linphone may connect
match = 172.31.16.0/24

; (You can add more endpoints, users, or identifiers below)

